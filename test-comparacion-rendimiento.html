<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparaci√≥n de Rendimiento - Original vs Optimizado</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        .version-card {
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        .original {
            background: #fff3cd;
            border-color: #ffc107;
        }
        .optimized {
            background: #d4edda;
            border-color: #28a745;
        }
        .test-controls {
            text-align: center;
            margin: 20px 0;
        }
        .test-controls button {
            margin: 10px;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .btn-original { background-color: #ffc107; color: black; }
        .btn-optimized { background-color: #28a745; color: white; }
        .btn-compare { background-color: #007bff; color: white; }
        .btn-compare:hover { background-color: #0056b3; }
        .metric-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
        }
        .slow { color: #dc3545; }
        .fast { color: #28a745; }
        .normal { color: #17a2b8; }
        .results-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .improvement {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .improvement-value {
            font-size: 18px;
            font-weight: bold;
            color: #155724;
        }
        .progress-bar {
            width: 100%;
            height: 25px;
            background-color: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffc107, #28a745);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .log-original { background-color: #fff3cd; }
        .log-optimized { background-color: #d4edda; }
        .log-comparison { background-color: #d1ecf1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° Comparaci√≥n de Rendimiento - Original vs Optimizado</h1>
        
        <div class="test-controls">
            <button class="btn-original" onclick="testOriginal()">
                üìä Test Versi√≥n Original
            </button>
            <button class="btn-optimized" onclick="testOptimized()">
                üöÄ Test Versi√≥n Optimizada
            </button>
            <button class="btn-compare" onclick="runComparisonTest()">
                ‚ö° Ejecutar Comparaci√≥n Completa
            </button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 0%">
                <span id="progressText">Listo para comenzar</span>
            </div>
        </div>

        <div class="comparison-grid">
            <div class="version-card original">
                <h3>üìä Versi√≥n Original</h3>
                <div class="metric-display">
                    <div class="metric-card">
                        <div class="metric-value slow" id="originalAdmin">-</div>
                        <div class="metric-label">Admin Panel</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value slow" id="originalEllos">-</div>
                        <div class="metric-label">Para Ellos</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value normal" id="originalEllas">-</div>
                        <div class="metric-label">Para Ellas</div>
                    </div>
                </div>
                <p><strong>Caracter√≠sticas:</strong></p>
                <ul>
                    <li>Carga todas las im√°genes de Supabase</li>
                    <li>Sin paginaci√≥n</li>
                    <li>Cache b√°sico</li>
                    <li>Consultas completas</li>
                </ul>
            </div>
            
            <div class="version-card optimized">
                <h3>üöÄ Versi√≥n Optimizada</h3>
                <div class="metric-display">
                    <div class="metric-card">
                        <div class="metric-value fast" id="optimizedAdmin">-</div>
                        <div class="metric-label">Admin Panel</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value fast" id="optimizedEllos">-</div>
                        <div class="metric-label">Para Ellos</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value fast" id="optimizedEllas">-</div>
                        <div class="metric-label">Para Ellas</div>
                    </div>
                </div>
                <p><strong>Optimizaciones:</strong></p>
                <ul>
                    <li>Im√°genes en l√≠nea (CDN)</li>
                    <li>Paginaci√≥n inteligente</li>
                    <li>Cache avanzado con TTL</li>
                    <li>Consultas limitadas</li>
                </ul>
            </div>
        </div>

        <div class="results-section">
            <h3>üìà Resultados de Mejora</h3>
            <div id="improvementResults">
                <p>Ejecuta los tests para ver las mejoras de rendimiento.</p>
            </div>
        </div>

        <div class="results-section">
            <h3>üìù Log de Ejecuci√≥n</h3>
            <div class="log-container" id="logContainer">
                <div class="log-entry log-comparison">
                    <strong>Sistema iniciado</strong> - Listo para comparar rendimiento
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/supabase-config-optimized.js"></script>
    
    <script>
        let testResults = {
            original: { admin: 0, ellos: 0, ellas: 0 },
            optimized: { admin: 0, ellos: 0, ellas: 0 }
        };

        function updateProgress(percentage, text) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = text;
        }

        function addLog(message, type = 'comparison') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function getSpeedClass(timeMs) {
            if (timeMs < 500) return 'fast';
            if (timeMs < 1000) return 'normal';
            return 'slow';
        }

        function updateDisplay(version, section, time) {
            const elementId = `${version}${section.charAt(0).toUpperCase() + section.slice(1)}`;
            const element = document.getElementById(elementId);
            
            if (element) {
                element.textContent = time + 'ms';
                element.className = 'metric-value ' + getSpeedClass(time);
            }
        }

        function showImprovements() {
            const improvementResults = document.getElementById('improvementResults');
            improvementResults.innerHTML = '';

            const sections = ['admin', 'ellos', 'ellas'];
            sections.forEach(section => {
                const original = testResults.original[section];
                const optimized = testResults.optimized[section];
                
                if (original > 0 && optimized > 0) {
                    const improvement = ((original - optimized) / original * 100).toFixed(1);
                    const timeSaved = original - optimized;
                    
                    const improvementDiv = document.createElement('div');
                    improvementDiv.className = 'improvement';
                    improvementDiv.innerHTML = `
                        <strong>${section.charAt(0).toUpperCase() + section.slice(1)}:</strong>
                        <div class="improvement-value">${improvement}% m√°s r√°pido</div>
                        <div>Tiempo ahorrado: ${timeSaved}ms</div>
                    `;
                    improvementResults.appendChild(improvementDiv);
                }
            });
        }

        // Test de versi√≥n original
        async function testOriginal() {
            addLog('üìä Iniciando test de versi√≥n original...', 'original');
            updateProgress(0, 'Testeando versi√≥n original...');
            
            try {
                // Test Admin Panel
                updateProgress(20, 'Original: Admin Panel...');
                const adminStart = Date.now();
                await ProductosService.obtenerProductos();
                const adminTime = Date.now() - adminStart;
                testResults.original.admin = adminTime;
                updateDisplay('original', 'admin', adminTime);
                addLog(`Admin Panel: ${adminTime}ms`, 'original');
                
                // Test Para Ellos
                updateProgress(50, 'Original: Para Ellos...');
                const ellosStart = Date.now();
                await ProductosService.obtenerProductosPorCategoria('Para Ellos');
                const ellosTime = Date.now() - ellosStart;
                testResults.original.ellos = ellosTime;
                updateDisplay('original', 'ellos', ellosTime);
                addLog(`Para Ellos: ${ellosTime}ms`, 'original');
                
                // Test Para Ellas
                updateProgress(80, 'Original: Para Ellas...');
                const ellasStart = Date.now();
                await ProductosService.obtenerProductosPorCategoria('Para Ellas');
                const ellasTime = Date.now() - ellasStart;
                testResults.original.ellas = ellasTime;
                updateDisplay('original', 'ellas', ellasTime);
                addLog(`Para Ellas: ${ellasTime}ms`, 'original');
                
                updateProgress(100, 'Test original completado');
                addLog('‚úÖ Test original completado', 'original');
                
                showImprovements();
                
            } catch (error) {
                addLog(`‚ùå Error en test original: ${error.message}`, 'original');
                updateProgress(100, 'Error en test original');
            }
        }

        // Test de versi√≥n optimizada
        async function testOptimized() {
            addLog('üöÄ Iniciando test de versi√≥n optimizada...', 'optimized');
            updateProgress(0, 'Testeando versi√≥n optimizada...');
            
            try {
                // Test Admin Panel
                updateProgress(20, 'Optimizado: Admin Panel...');
                const adminStart = Date.now();
                await ProductosServiceOptimized.obtenerProductosAdmin();
                const adminTime = Date.now() - adminStart;
                testResults.optimized.admin = adminTime;
                updateDisplay('optimized', 'admin', adminTime);
                addLog(`Admin Panel: ${adminTime}ms`, 'optimized');
                
                // Test Para Ellos
                updateProgress(50, 'Optimizado: Para Ellos...');
                const ellosStart = Date.now();
                await ProductosServiceOptimized.obtenerProductosPorCategoriaOptimizado('Para Ellos');
                const ellosTime = Date.now() - ellosStart;
                testResults.optimized.ellos = ellosTime;
                updateDisplay('optimized', 'ellos', ellosTime);
                addLog(`Para Ellos: ${ellosTime}ms`, 'optimized');
                
                // Test Para Ellas
                updateProgress(80, 'Optimizado: Para Ellas...');
                const ellasStart = Date.now();
                await ProductosServiceOptimized.obtenerProductosPorCategoriaOptimizado('Para Ellas');
                const ellasTime = Date.now() - ellasStart;
                testResults.optimized.ellas = ellasTime;
                updateDisplay('optimized', 'ellas', ellasTime);
                addLog(`Para Ellas: ${ellasTime}ms`, 'optimized');
                
                updateProgress(100, 'Test optimizado completado');
                addLog('‚úÖ Test optimizado completado', 'optimized');
                
                showImprovements();
                
                // Mostrar m√©tricas adicionales
                const metrics = ProductosServiceOptimized.getPerformanceMetrics();
                addLog(`üìä Cache hits: ${metrics.cacheHits}/${metrics.totalCacheKeys}`, 'optimized');
                
            } catch (error) {
                addLog(`‚ùå Error en test optimizado: ${error.message}`, 'optimized');
                updateProgress(100, 'Error en test optimizado');
            }
        }

        // Ejecutar comparaci√≥n completa
        async function runComparisonTest() {
            addLog('‚ö° Iniciando comparaci√≥n completa...', 'comparison');
            updateProgress(0, 'Comparaci√≥n completa iniciada...');
            
            // Limpiar cache antes de empezar
            if (typeof ProductosServiceOptimized.clearCache === 'function') {
                ProductosServiceOptimized.clearCache();
            }
            
            updateProgress(10, 'Ejecutando test original...');
            await testOriginal();
            
            updateProgress(60, 'Ejecutando test optimizado...');
            await testOptimized();
            
            updateProgress(100, 'Comparaci√≥n completada');
            addLog('üéâ Comparaci√≥n completa terminada', 'comparison');
            
            // Calcular mejora total
            const totalOriginal = testResults.original.admin + testResults.original.ellos + testResults.original.ellas;
            const totalOptimized = testResults.optimized.admin + testResults.optimized.ellos + testResults.optimized.ellas;
            const totalImprovement = ((totalOriginal - totalOptimized) / totalOriginal * 100).toFixed(1);
            
            addLog(`üìä Mejora total: ${totalImprovement}% m√°s r√°pido`, 'comparison');
            addLog(`‚è±Ô∏è Tiempo total ahorrado: ${totalOriginal - totalOptimized}ms`, 'comparison');
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üéØ Sistema de comparaci√≥n inicializado', 'comparison');
            updateProgress(0, 'Listo para comenzar');
        });
    </script>
</body>
</html>
