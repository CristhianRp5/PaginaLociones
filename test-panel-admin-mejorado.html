<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Panel Admin Mejorado</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .test-section h2 {
            color: #666;
            margin-bottom: 15px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        
        .link-button {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 8px;
            font-size: 18px;
            display: inline-block;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .link-button:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #28a745;
        }
        
        .status-offline {
            background: #dc3545;
        }
        
        .status-warning {
            background: #ffc107;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test - Panel Admin Mejorado</h1>
        
        <div class="test-section">
            <h2>üîó Acceso R√°pido</h2>
            <a href="admin-panel-estructura-mejorada.html" class="link-button">
                üöÄ Abrir Panel Admin Mejorado
            </a>
            <a href="html/admin-panel.html" class="link-button">
                üìã Panel Admin Original
            </a>
        </div>
        
        <div class="test-section">
            <h2>üîç Verificaci√≥n de Archivos</h2>
            <button class="test-button" onclick="verificarArchivos()">
                Verificar Archivos
            </button>
            <div id="verificarArchivosResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Estado de Dependencias</h2>
            <button class="test-button" onclick="verificarDependencias()">
                Verificar Dependencias
            </button>
            <div id="verificarDependenciasResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>üßÆ Test de Funciones Auxiliares</h2>
            <button class="test-button" onclick="testFuncionesAuxiliares()">
                Test Funciones
            </button>
            <div id="testFuncionesResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>üóÉÔ∏è Test de Estructura BD</h2>
            <button class="test-button" onclick="testEstructuraBD()">
                Test Estructura BD
            </button>
            <div id="testEstructuraBDResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>üìù Notas de Mejoras</h2>
            <div class="info">
<strong>‚úÖ Mejoras Implementadas:</strong>
- Manejo robusto de tipos de datos distintos (object/null vs string)
- Funciones auxiliares para limpiar datos de la BD
- Ignorar campos extra de la BD sin afectar el formulario
- Prioridad imagen_url > imagen > placeholder
- Validaciones mejoradas para URLs e im√°genes
- Interfaz m√°s moderna y responsive
- Mejor manejo de errores y loading
- Sistema de alertas mejorado
- Funcionalidad completa de CRUD
- B√∫squeda y filtrado de productos
- Estad√≠sticas de categor√≠as
- Panel de configuraci√≥n

<strong>üîß Campos Manejados:</strong>
- slug (ignorado)
- descripcion_corta (ignorado)  
- marca_id (ignorado)
- categoria_id (ignorado)
- imagen_principal (ignorado)
- notas_salida (ignorado)
- notas_corazon (ignorado)
- notas_fondo (ignorado)
- stock (ignorado)
- disponible (ignorado)

<strong>üéØ Tipos Compatibles:</strong>
- Strings y objects con null
- N√∫meros y strings
- Booleanos y strings/numbers
- Fechas en formato string
- Im√°genes URL vs base64
            </div>
        </div>
    </div>

    <script>
        // Funciones de test
        async function verificarArchivos() {
            const resultado = document.getElementById('verificarArchivosResult');
            resultado.innerHTML = 'Verificando archivos...';
            
            const archivos = [
                'admin-panel-estructura-mejorada.html',
                'js/admin-panel-mejorado.js',
                'css/admin-panel-mejorado.css',
                'js/supabase-config-optimized.js'
            ];
            
            let resultados = 'üîç Verificaci√≥n de Archivos:\\n\\n';
            
            for (const archivo of archivos) {
                try {
                    const response = await fetch(archivo, { method: 'HEAD' });
                    const status = response.ok ? '‚úÖ' : '‚ùå';
                    const statusText = response.ok ? 'OK' : `Error ${response.status}`;
                    resultados += `${status} ${archivo} - ${statusText}\\n`;
                } catch (error) {
                    resultados += `‚ùå ${archivo} - Error: ${error.message}\\n`;
                }
            }
            
            resultado.innerHTML = resultados;
            resultado.className = 'test-result info';
        }
        
        async function verificarDependencias() {
            const resultado = document.getElementById('verificarDependenciasResult');
            resultado.innerHTML = 'Verificando dependencias...';
            
            let resultados = 'üìä Estado de Dependencias:\\n\\n';
            
            // Verificar Supabase
            if (typeof window.supabase !== 'undefined') {
                resultados += '‚úÖ Supabase - Disponible\\n';
            } else {
                resultados += '‚ùå Supabase - No disponible\\n';
            }
            
            // Verificar ProductosServiceOptimized
            if (typeof ProductosServiceOptimized !== 'undefined') {
                resultados += '‚úÖ ProductosServiceOptimized - Disponible\\n';
            } else {
                resultados += '‚ùå ProductosServiceOptimized - No disponible\\n';
            }
            
            // Verificar AdminPanel
            if (typeof AdminPanel !== 'undefined') {
                resultados += '‚úÖ AdminPanel - Disponible\\n';
            } else {
                resultados += '‚ùå AdminPanel - No disponible\\n';
            }
            
            // Verificar Font Awesome
            const faIcons = document.querySelectorAll('i.fas, i.far, i.fab');
            if (faIcons.length > 0) {
                resultados += '‚úÖ Font Awesome - Icons encontrados\\n';
            } else {
                resultados += '‚ö†Ô∏è Font Awesome - No se encontraron icons\\n';
            }
            
            resultado.innerHTML = resultados;
            resultado.className = 'test-result info';
        }
        
        function testFuncionesAuxiliares() {
            const resultado = document.getElementById('testFuncionesResult');
            
            let resultados = 'üßÆ Test de Funciones Auxiliares:\\n\\n';
            
            // Simular AdminPanel para test
            const testAdmin = {
                cleanFieldValue: function(value, defaultValue = '') {
                    if (value === null || value === undefined) return defaultValue;
                    if (typeof value === 'object') return defaultValue;
                    if (typeof value === 'string') return value.trim();
                    if (typeof value === 'number') return value.toString();
                    if (typeof value === 'boolean') return value.toString();
                    return defaultValue;
                },
                
                cleanBooleanValue: function(value, defaultValue = false) {
                    if (value === null || value === undefined) return defaultValue;
                    if (typeof value === 'boolean') return value;
                    if (typeof value === 'string') return value.toLowerCase() === 'true';
                    if (typeof value === 'number') return value !== 0;
                    return defaultValue;
                },
                
                cleanImageValue: function(value) {
                    if (!value) return null;
                    if (typeof value === 'object') return null;
                    if (typeof value === 'string' && value.trim() !== '') return value.trim();
                    return null;
                }
            };
            
            // Test cleanFieldValue
            const fieldTests = [
                { input: null, expected: '', description: 'null ‚Üí empty string' },
                { input: undefined, expected: '', description: 'undefined ‚Üí empty string' },
                { input: {}, expected: '', description: 'object ‚Üí empty string' },
                { input: 'test', expected: 'test', description: 'string ‚Üí string' },
                { input: '  test  ', expected: 'test', description: 'trimmed string' },
                { input: 123, expected: '123', description: 'number ‚Üí string' },
                { input: true, expected: 'true', description: 'boolean ‚Üí string' }
            ];
            
            resultados += 'üîß cleanFieldValue Tests:\\n';
            fieldTests.forEach(test => {
                const result = testAdmin.cleanFieldValue(test.input);
                const status = result === test.expected ? '‚úÖ' : '‚ùå';
                resultados += `${status} ${test.description}: ${JSON.stringify(test.input)} ‚Üí ${JSON.stringify(result)}\\n`;
            });
            
            // Test cleanBooleanValue
            const booleanTests = [
                { input: true, expected: true, description: 'boolean true' },
                { input: false, expected: false, description: 'boolean false' },
                { input: 'true', expected: true, description: 'string "true"' },
                { input: 'false', expected: false, description: 'string "false"' },
                { input: 1, expected: true, description: 'number 1' },
                { input: 0, expected: false, description: 'number 0' },
                { input: null, expected: false, description: 'null ‚Üí false' },
                { input: {}, expected: false, description: 'object ‚Üí false' }
            ];
            
            resultados += '\\nüîß cleanBooleanValue Tests:\\n';
            booleanTests.forEach(test => {
                const result = testAdmin.cleanBooleanValue(test.input);
                const status = result === test.expected ? '‚úÖ' : '‚ùå';
                resultados += `${status} ${test.description}: ${JSON.stringify(test.input)} ‚Üí ${result}\\n`;
            });
            
            // Test cleanImageValue
            const imageTests = [
                { input: 'https://example.com/image.jpg', expected: 'https://example.com/image.jpg', description: 'valid URL' },
                { input: '  https://example.com/image.jpg  ', expected: 'https://example.com/image.jpg', description: 'trimmed URL' },
                { input: '', expected: null, description: 'empty string' },
                { input: null, expected: null, description: 'null' },
                { input: {}, expected: null, description: 'object' },
                { input: undefined, expected: null, description: 'undefined' }
            ];
            
            resultados += '\\nüîß cleanImageValue Tests:\\n';
            imageTests.forEach(test => {
                const result = testAdmin.cleanImageValue(test.input);
                const status = result === test.expected ? '‚úÖ' : '‚ùå';
                resultados += `${status} ${test.description}: ${JSON.stringify(test.input)} ‚Üí ${JSON.stringify(result)}\\n`;
            });
            
            resultado.innerHTML = resultados;
            resultado.className = 'test-result success';
        }
        
        function testEstructuraBD() {
            const resultado = document.getElementById('testEstructuraBDResult');
            
            let resultados = 'üóÉÔ∏è Test de Estructura BD:\\n\\n';
            
            // Simular producto de BD con campos extra y tipos distintos
            const productoSimulado = {
                id: 1,
                nombre: 'Producto Test',
                marca: 'Marca Test',
                precio: 50000,
                ml: 100,
                categoria: 'para-ellos',
                subcategoria: 'designer',
                descripcion: 'Descripci√≥n de prueba',
                notas: 'Notas de prueba',
                estado: 'disponible',
                descuento: null, // object null
                luxury: false,
                activo: true,
                imagen: 'https://example.com/image.jpg',
                imagen_url: null, // object null
                created_at: '2025-01-08T10:00:00Z',
                updated_at: '2025-01-08T10:00:00Z',
                // Campos extra que se ignoran
                slug: 'producto-test',
                descripcion_corta: 'Descripci√≥n corta',
                marca_id: 1,
                categoria_id: 1,
                imagen_principal: null,
                notas_salida: null,
                notas_corazon: null,
                notas_fondo: null,
                stock: 10,
                disponible: true
            };
            
            resultados += 'üìã Producto Simulado de BD:\\n';
            resultados += `- ID: ${productoSimulado.id}\\n`;
            resultados += `- Nombre: ${productoSimulado.nombre}\\n`;
            resultados += `- Campos totales: ${Object.keys(productoSimulado).length}\\n`;
            
            // Campos esperados por el panel
            const camposEsperados = [
                'id', 'nombre', 'marca', 'precio', 'ml', 'categoria', 'subcategoria',
                'descripcion', 'notas', 'estado', 'descuento', 'luxury', 'activo',
                'imagen', 'imagen_url', 'created_at', 'updated_at'
            ];
            
            // Campos extra (se ignoran)
            const camposExtra = Object.keys(productoSimulado).filter(key => !camposEsperados.includes(key));
            
            resultados += `\\nüìä An√°lisis de Campos:\\n`;
            resultados += `- Campos esperados: ${camposEsperados.length}\\n`;
            resultados += `- Campos extra: ${camposExtra.length}\\n`;
            resultados += `- Campos extra: ${camposExtra.join(', ')}\\n`;
            
            // Test de manejo de tipos
            resultados += `\\nüîß Manejo de Tipos:\\n`;
            resultados += `- descuento (null): ${productoSimulado.descuento} ‚Üí se maneja como object\\n`;
            resultados += `- imagen_url (null): ${productoSimulado.imagen_url} ‚Üí se maneja como object\\n`;
            resultados += `- luxury (boolean): ${productoSimulado.luxury} ‚Üí se mantiene\\n`;
            resultados += `- activo (boolean): ${productoSimulado.activo} ‚Üí se mantiene\\n`;
            
            resultados += `\\n‚úÖ El panel admin mejorado puede manejar:\\n`;
            resultados += `- Campos extra sin errores\\n`;
            resultados += `- Tipos object/null correctamente\\n`;
            resultados += `- Prioridad imagen_url > imagen\\n`;
            resultados += `- Validaciones robustas\\n`;
            
            resultado.innerHTML = resultados;
            resultado.className = 'test-result success';
        }
        
        // Auto-ejecutar verificaci√≥n inicial
        window.addEventListener('load', () => {
            setTimeout(() => {
                verificarArchivos();
                verificarDependencias();
            }, 1000);
        });
    </script>
</body>
</html>
