<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - NavegaciÃ³n Singleton Carrito</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/slide-cart.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #45a049;
        }
        
        .test-button.danger {
            background: #f44336;
        }
        
        .test-button.warning {
            background: #ff9800;
        }
        
        .test-button.info {
            background: #2196F3;
        }
        
        .navigation-links {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        
        .navigation-links a {
            padding: 12px 24px;
            background: #333;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .navigation-links a:hover {
            background: #555;
        }
        
        .status-display {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Test - NavegaciÃ³n con Singleton del Carrito</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ Instrucciones del Test</h3>
            <p>1. Agrega productos al carrito usando los botones de abajo</p>
            <p>2. Navega a diferentes pÃ¡ginas usando los enlaces</p>
            <p>3. Verifica que los productos no se pierdan al volver</p>
            <p>4. Usa las funciones de debug para verificar el estado</p>
        </div>
        
        <div class="navigation-links">
            <a href="index.html">ğŸ  Index</a>
            <a href="html/para_ellos.html">ğŸ‘¨ Para Ellos</a>
            <a href="html/para_ellas.html">ğŸ‘© Para Ellas</a>
            <a href="test-navegacion-singleton.html">ğŸ”„ Recargar Test</a>
        </div>
        
        <div class="test-section">
            <h2>ğŸ›’ SimulaciÃ³n de Productos</h2>
            <button class="test-button" onclick="addTestProduct1()">
                â• Agregar Colonia Masculina ($50)
            </button>
            <button class="test-button" onclick="addTestProduct2()">
                â• Agregar Perfume Femenino ($75)
            </button>
            <button class="test-button" onclick="addTestProduct3()">
                â• Agregar Fragancia Unisex ($60)
            </button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ” Estado del Carrito</h2>
            <button class="test-button info" onclick="showCartStatus()">
                ğŸ“Š Ver Estado Actual
            </button>
            <button class="test-button info" onclick="showCartTime()">
                â° Ver Tiempo del Carrito
            </button>
            <button class="test-button info" onclick="showCartContents()">
                ğŸ“¦ Ver Contenido Detallado
            </button>
            <button class="test-button" onclick="toggleCart()">
                ğŸ‘ï¸ Mostrar/Ocultar Carrito
            </button>
            
            <div id="statusDisplay" class="status-display"></div>
        </div>
        
        <div class="test-section">
            <h2>âš™ï¸ Funciones de Debug</h2>
            <button class="test-button warning" onclick="debugCart()">
                ğŸ”§ Debug Completo
            </button>
            <button class="test-button warning" onclick="debugLocalStorage()">
                ğŸ’¾ Debug LocalStorage
            </button>
            <button class="test-button warning" onclick="verifyInstanceUniqueness()">
                ğŸ†” Verificar Instancia Ãšnica
            </button>
            <button class="test-button warning" onclick="testInstancePersistence()">
                ğŸ”— Test Persistencia Instancia
            </button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§¹ Limpieza y Reset</h2>
            <button class="test-button danger" onclick="clearCart()">
                ğŸ—‘ï¸ Limpiar Carrito
            </button>
            <button class="test-button danger" onclick="clearLocalStorage()">
                ğŸ’¥ Limpiar LocalStorage
            </button>
            <button class="test-button warning" onclick="forceReinit()">
                ğŸ”„ Forzar ReinicializaciÃ³n
            </button>
        </div>
        
        <div class="warning-box">
            <h3>âš ï¸ Test de NavegaciÃ³n</h3>
            <p><strong>Pasos crÃ­ticos:</strong></p>
            <ol>
                <li>Agrega al menos 2 productos diferentes</li>
                <li>Ve a "Para Ellos" y agrega mÃ¡s productos</li>
                <li>Regresa a Index - Â¿Los productos siguen ahÃ­?</li>
                <li>Ve a "Para Ellas" - Â¿Se mantienen todos los productos?</li>
                <li>Recarga cualquier pÃ¡gina - Â¿Persisten por la hora completa?</li>
            </ol>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/cart.js"></script>
    <script>
        // Variables para tracking de instancias
        let instanceId = Date.now();
        
        // Funciones de simulaciÃ³n de productos
        function addTestProduct1() {
            const product = {
                id: 'test-001',
                nombre: 'Colonia Masculina Test',
                marca: 'TestBrand',
                precio: 50,
                categoria: 'para-ellos',
                imagen_url: '../IMAGENES/PARA_ELLOS.png'
            };
            
            if (window.shoppingCart) {
                window.shoppingCart.addItem(product);
                updateStatus('âœ… Producto masculino agregado al carrito');
            } else {
                updateStatus('âŒ Carrito no disponible');
            }
        }
        
        function addTestProduct2() {
            const product = {
                id: 'test-002',
                nombre: 'Perfume Femenino Test',
                marca: 'TestBrand',
                precio: 75,
                categoria: 'para-ellas',
                imagen_url: '../IMAGENES/PARA_ELLAS.png'
            };
            
            if (window.shoppingCart) {
                window.shoppingCart.addItem(product);
                updateStatus('âœ… Producto femenino agregado al carrito');
            } else {
                updateStatus('âŒ Carrito no disponible');
            }
        }
        
        function addTestProduct3() {
            const product = {
                id: 'test-003',
                nombre: 'Fragancia Unisex Test',
                marca: 'TestBrand',
                precio: 60,
                categoria: 'unisex',
                imagen_url: '../IMAGENES/placeholder.png'
            };
            
            if (window.shoppingCart) {
                window.shoppingCart.addItem(product);
                updateStatus('âœ… Producto unisex agregado al carrito');
            } else {
                updateStatus('âŒ Carrito no disponible');
            }
        }
        
        // Funciones de estado y debug
        function showCartStatus() {
            if (window.shoppingCart) {
                const status = window.shoppingCart.getCartStatus();
                const timeInfo = window.shoppingCart.getCartTimeInfo();
                
                let info = `ğŸ“Š ESTADO DEL CARRITO:\n`;
                info += `Items: ${status.totalItems}\n`;
                info += `Total: $${status.totalAmount}\n`;
                info += `Inicializado: ${status.isInitialized}\n\n`;
                
                if (timeInfo && !timeInfo.expired) {
                    info += `â° TIEMPO:\n`;
                    info += `Minutos restantes: ${timeInfo.remainingMinutes}\n`;
                    info += `Expira: ${timeInfo.expirationTime}\n`;
                } else if (timeInfo && timeInfo.expired) {
                    info += `â° TIEMPO: EXPIRADO\n`;
                } else {
                    info += `â° TIEMPO: Sin informaciÃ³n\n`;
                }
                
                updateStatus(info);
            } else {
                updateStatus('âŒ Carrito no disponible');
            }
        }
        
        function showCartTime() {
            if (window.checkCartTime) {
                const timeInfo = window.checkCartTime();
                updateStatus(timeInfo ? 'âœ… Ver consola para detalles de tiempo' : 'âŒ No hay informaciÃ³n de tiempo');
            } else {
                updateStatus('âŒ FunciÃ³n checkCartTime no disponible');
            }
        }
        
        function showCartContents() {
            if (window.shoppingCart && window.shoppingCart.items) {
                let content = `ğŸ“¦ CONTENIDO DEL CARRITO (${window.shoppingCart.items.length} items):\n\n`;
                
                window.shoppingCart.items.forEach((item, index) => {
                    content += `${index + 1}. ${item.nombre}\n`;
                    content += `   Marca: ${item.marca}\n`;
                    content += `   Precio: $${item.precio}\n`;
                    content += `   Cantidad: ${item.quantity}\n`;
                    content += `   ID: ${item.id}\n\n`;
                });
                
                updateStatus(content);
            } else {
                updateStatus('âŒ Carrito vacÃ­o o no disponible');
            }
        }
        
        function toggleCart() {
            if (window.shoppingCart) {
                window.shoppingCart.toggleCart();
                updateStatus('ğŸ”„ Carrito toggled');
            } else {
                updateStatus('âŒ Carrito no disponible para toggle');
            }
        }
        
        function debugCart() {
            if (window.shoppingCart && typeof window.shoppingCart.debugCart === 'function') {
                window.shoppingCart.debugCart();
                updateStatus('ğŸ”§ Debug ejecutado - ver consola para detalles');
            } else {
                updateStatus('âŒ FunciÃ³n debug no disponible');
            }
        }
        
        function debugLocalStorage() {
            if (window.debugCartLocalStorage) {
                window.debugCartLocalStorage();
                updateStatus('ğŸ’¾ Debug de localStorage ejecutado - ver consola');
            } else {
                updateStatus('âŒ FunciÃ³n debugLocalStorage no disponible');
            }
        }
        
        function verifyInstanceUniqueness() {
            let info = `ğŸ†” VERIFICACIÃ“N DE INSTANCIA ÃšNICA:\n\n`;
            info += `window.shoppingCart existe: ${!!window.shoppingCart}\n`;
            info += `Tipo: ${typeof window.shoppingCart}\n`;
            
            if (window.shoppingCart) {
                info += `Inicializado: ${window.shoppingCart.isInitialized}\n`;
                info += `Constructor: ${window.shoppingCart.constructor.name}\n`;
                info += `Items: ${window.shoppingCart.items ? window.shoppingCart.items.length : 'undefined'}\n`;
                
                // Verificar si es la misma instancia
                if (!window.cartInstanceId) {
                    window.cartInstanceId = instanceId;
                    window.shoppingCart._testInstanceId = instanceId;
                }
                
                info += `\nInstance ID actual: ${instanceId}\n`;
                info += `Instance ID del carrito: ${window.shoppingCart._testInstanceId || 'No asignado'}\n`;
                info += `Es la misma instancia: ${window.shoppingCart._testInstanceId === instanceId}\n`;
            }
            
            updateStatus(info);
        }
        
        function testInstancePersistence() {
            if (window.shoppingCart) {
                // Marcar la instancia actual
                window.shoppingCart._testMark = Date.now();
                const mark = window.shoppingCart._testMark;
                
                updateStatus(`ğŸ”— Instancia marcada con: ${mark}\nVerifica despuÃ©s de navegar que el mark persista`);
            } else {
                updateStatus('âŒ No hay instancia para marcar');
            }
        }
        
        function clearCart() {
            if (window.shoppingCart) {
                window.shoppingCart.clearCart();
                updateStatus('ğŸ—‘ï¸ Carrito limpiado');
            } else {
                updateStatus('âŒ Carrito no disponible para limpiar');
            }
        }
        
        function clearLocalStorage() {
            localStorage.removeItem('shopping_cart');
            updateStatus('ğŸ’¥ LocalStorage del carrito limpiado');
        }
        
        function forceReinit() {
            if (window.forceInitCart) {
                const success = window.forceInitCart();
                updateStatus(success ? 'ğŸ”„ ReinicializaciÃ³n forzada exitosa' : 'âŒ Error en reinicializaciÃ³n');
            } else {
                updateStatus('âŒ FunciÃ³n forceInitCart no disponible');
            }
        }
        
        function updateStatus(message) {
            const display = document.getElementById('statusDisplay');
            const timestamp = new Date().toLocaleTimeString();
            display.textContent = `[${timestamp}] ${message}`;
            console.log(`[Test Cart] ${message}`);
        }
        
        // VerificaciÃ³n inicial
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateStatus('ğŸš€ PÃ¡gina de test cargada\n' + 
                    `Carrito disponible: ${!!window.shoppingCart}\n` +
                    `FunciÃ³n singleton: ${!!window.getShoppingCartInstance}`);
            }, 1000);
        });
        
        // Log cuando se navega
        window.addEventListener('beforeunload', function() {
            console.log('ğŸ”„ Navegando desde test page...');
            if (window.shoppingCart && window.shoppingCart.items) {
                console.log(`ğŸ“¦ Items en carrito antes de navegar: ${window.shoppingCart.items.length}`);
            }
        });
    </script>
</body>
</html>
