<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Navegaci√≥n Singleton Carrito</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/slide-cart.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #45a049;
        }
        
        .test-button.danger {
            background: #f44336;
        }
        
        .test-button.warning {
            background: #ff9800;
        }
        
        .test-button.info {
            background: #2196F3;
        }
        
        .navigation-links {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        
        .navigation-links a {
            padding: 12px 24px;
            background: #333;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .navigation-links a:hover {
            background: #555;
        }
        
        .status-display {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test - Navegaci√≥n con Singleton del Carrito</h1>
        
        <div class="info-box">
            <h3>üìã Instrucciones del Test</h3>
            <p>1. Agrega productos al carrito usando los botones de abajo</p>
            <p>2. Navega a diferentes p√°ginas usando los enlaces</p>
            <p>3. Verifica que los productos no se pierdan al volver</p>
            <p>4. Usa las funciones de debug para verificar el estado</p>
        </div>
        
        <div class="navigation-links">
            <a href="index.html">üè† Index</a>
            <a href="html/para_ellos.html">üë® Para Ellos</a>
            <a href="html/para_ellas.html">üë© Para Ellas</a>
            <a href="test-navegacion-singleton.html">üîÑ Recargar Test</a>
        </div>
        
        <div class="test-section">
            <h2>üõí Simulaci√≥n de Productos</h2>
            <button class="test-button" onclick="addTestProduct1()">
                ‚ûï Agregar Colonia Masculina ($50)
            </button>
            <button class="test-button" onclick="addTestProduct2()">
                ‚ûï Agregar Perfume Femenino ($75)
            </button>
            <button class="test-button" onclick="addTestProduct3()">
                ‚ûï Agregar Fragancia Unisex ($60)
            </button>
        </div>
        
        <div class="test-section">
            <h2>üîç Estado del Carrito</h2>
            <button class="test-button info" onclick="showCartStatus()">
                üìä Ver Estado Actual
            </button>
            <button class="test-button info" onclick="showCartTime()">
                ‚è∞ Ver Tiempo del Carrito
            </button>
            <button class="test-button info" onclick="showCartContents()">
                üì¶ Ver Contenido Detallado
            </button>
            <button class="test-button" onclick="toggleCart()">
                üëÅÔ∏è Mostrar/Ocultar Carrito
            </button>
            
            <div id="statusDisplay" class="status-display"></div>
        </div>
        
        <div class="test-section">
            <h2>‚öôÔ∏è Funciones de Debug</h2>
            <button class="test-button warning" onclick="debugCart()">
                üîß Debug Completo
            </button>
            <button class="test-button warning" onclick="debugLocalStorage()">
                üíæ Debug LocalStorage
            </button>
            <button class="test-button warning" onclick="verifyInstanceUniqueness()">
                üÜî Verificar Instancia √önica
            </button>
            <button class="test-button warning" onclick="testInstancePersistence()">
                üîó Test Persistencia Instancia
            </button>
        </div>
        
        <div class="test-section">
            <h2>üßπ Limpieza y Reset</h2>
            <button class="test-button danger" onclick="clearCart()">
                üóëÔ∏è Limpiar Carrito
            </button>
            <button class="test-button danger" onclick="clearLocalStorage()">
                üí• Limpiar LocalStorage
            </button>
            <button class="test-button warning" onclick="forceReinit()">
                üîÑ Forzar Reinicializaci√≥n
            </button>
        </div>
        
        <div class="warning-box">
            <h3>‚ö†Ô∏è Test de Navegaci√≥n</h3>
            <p><strong>Pasos cr√≠ticos:</strong></p>
            <ol>
                <li>Agrega al menos 2 productos diferentes</li>
                <li>Ve a "Para Ellos" y agrega m√°s productos</li>
                <li>Regresa a Index - ¬øLos productos siguen ah√≠?</li>
                <li>Ve a "Para Ellas" - ¬øSe mantienen todos los productos?</li>
                <li>Recarga cualquier p√°gina - ¬øPersisten por la hora completa?</li>
            </ol>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/cart.js"></script>
    <script>
        // Variables para tracking de instancias
        let instanceId = Date.now();
        
        // Funciones de simulaci√≥n de productos
        function addTestProduct1() {
            const product = {
                id: 'test-001',
                nombre: 'Colonia Masculina Test',
                marca: 'TestBrand',
                precio: 50,
                categoria: 'para-ellos',
                imagen_url: '../IMAGENES/PARA_ELLOS.png'
            };
            
            if (window.shoppingCart) {
                window.shoppingCart.addItem(product);
                updateStatus('‚úÖ Producto masculino agregado al carrito');
            } else {
                updateStatus('‚ùå Carrito no disponible');
            }
        }
        
        function addTestProduct2() {
            const product = {
                id: 'test-002',
                nombre: 'Perfume Femenino Test',
                marca: 'TestBrand',
                precio: 75,
                categoria: 'para-ellas',
                imagen_url: '../IMAGENES/PARA_ELLAS.png'
            };
            
            if (window.shoppingCart) {
                window.shoppingCart.addItem(product);
                updateStatus('‚úÖ Producto femenino agregado al carrito');
            } else {
                updateStatus('‚ùå Carrito no disponible');
            }
        }
        
        function addTestProduct3() {
            const product = {
                id: 'test-003',
                nombre: 'Fragancia Unisex Test',
                marca: 'TestBrand',
                precio: 60,
                categoria: 'unisex',
                imagen_url: '../IMAGENES/placeholder.png'
            };
            
            if (window.shoppingCart) {
                window.shoppingCart.addItem(product);
                updateStatus('‚úÖ Producto unisex agregado al carrito');
            } else {
                updateStatus('‚ùå Carrito no disponible');
            }
        }
        
        // Funciones de estado y debug
        function showCartStatus() {
            if (window.shoppingCart) {
                const status = window.shoppingCart.getCartStatus();
                const timeInfo = window.shoppingCart.getCartTimeInfo();
                
                let info = `üìä ESTADO DEL CARRITO:\n`;
                info += `Items: ${status.totalItems}\n`;
                info += `Total: $${status.totalAmount}\n`;
                info += `Inicializado: ${status.isInitialized}\n\n`;
                
                if (timeInfo && !timeInfo.expired) {
                    info += `‚è∞ TIEMPO:\n`;
                    info += `Minutos restantes: ${timeInfo.remainingMinutes}\n`;
                    info += `Expira: ${timeInfo.expirationTime}\n`;
                } else if (timeInfo && timeInfo.expired) {
                    info += `‚è∞ TIEMPO: EXPIRADO\n`;
                } else {
                    info += `‚è∞ TIEMPO: Sin informaci√≥n\n`;
                }
                
                updateStatus(info);
            } else {
                updateStatus('‚ùå Carrito no disponible');
            }
        }
        
        function showCartTime() {
            if (window.checkCartTime) {
                const timeInfo = window.checkCartTime();
                updateStatus(timeInfo ? '‚úÖ Ver consola para detalles de tiempo' : '‚ùå No hay informaci√≥n de tiempo');
            } else {
                updateStatus('‚ùå Funci√≥n checkCartTime no disponible');
            }
        }
        
        function showCartContents() {
            if (window.shoppingCart && window.shoppingCart.items) {
                let content = `üì¶ CONTENIDO DEL CARRITO (${window.shoppingCart.items.length} items):\n\n`;
                
                window.shoppingCart.items.forEach((item, index) => {
                    content += `${index + 1}. ${item.nombre}\n`;
                    content += `   Marca: ${item.marca}\n`;
                    content += `   Precio: $${item.precio}\n`;
                    content += `   Cantidad: ${item.quantity}\n`;
                    content += `   ID: ${item.id}\n\n`;
                });
                
                updateStatus(content);
            } else {
                updateStatus('‚ùå Carrito vac√≠o o no disponible');
            }
        }
        
        function toggleCart() {
            if (window.shoppingCart) {
                window.shoppingCart.toggleCart();
                updateStatus('üîÑ Carrito toggled');
            } else {
                updateStatus('‚ùå Carrito no disponible para toggle');
            }
        }
        
        function debugCart() {
            if (window.shoppingCart && typeof window.shoppingCart.debugCart === 'function') {
                window.shoppingCart.debugCart();
                updateStatus('üîß Debug ejecutado - ver consola para detalles');
            } else {
                updateStatus('‚ùå Funci√≥n debug no disponible');
            }
        }
        
        function debugLocalStorage() {
            if (window.debugCartLocalStorage) {
                window.debugCartLocalStorage();
                updateStatus('üíæ Debug de localStorage ejecutado - ver consola');
            } else {
                updateStatus('‚ùå Funci√≥n debugLocalStorage no disponible');
            }
        }
        
        function verifyInstanceUniqueness() {
            let info = `üÜî VERIFICACI√ìN DE INSTANCIA √öNICA:\n\n`;
            info += `window.shoppingCart existe: ${!!window.shoppingCart}\n`;
            info += `Tipo: ${typeof window.shoppingCart}\n`;
            
            if (window.shoppingCart) {
                info += `Inicializado: ${window.shoppingCart.isInitialized}\n`;
                info += `Constructor: ${window.shoppingCart.constructor.name}\n`;
                info += `Items: ${window.shoppingCart.items ? window.shoppingCart.items.length : 'undefined'}\n`;
                
                // Verificar si es la misma instancia
                if (!window.cartInstanceId) {
                    window.cartInstanceId = instanceId;
                    window.shoppingCart._testInstanceId = instanceId;
                }
                
                info += `\nInstance ID actual: ${instanceId}\n`;
                info += `Instance ID del carrito: ${window.shoppingCart._testInstanceId || 'No asignado'}\n`;
                info += `Es la misma instancia: ${window.shoppingCart._testInstanceId === instanceId}\n`;
            }
            
            updateStatus(info);
        }
        
        function testInstancePersistence() {
            if (window.shoppingCart) {
                // Marcar la instancia actual
                window.shoppingCart._testMark = Date.now();
                const mark = window.shoppingCart._testMark;
                
                updateStatus(`üîó Instancia marcada con: ${mark}\nVerifica despu√©s de navegar que el mark persista`);
            } else {
                updateStatus('‚ùå No hay instancia para marcar');
            }
        }
        
        function clearCart() {
            if (window.shoppingCart) {
                window.shoppingCart.clearCart();
                updateStatus('üóëÔ∏è Carrito limpiado');
            } else {
                updateStatus('‚ùå Carrito no disponible para limpiar');
            }
        }
        
        function clearLocalStorage() {
            localStorage.removeItem('shopping_cart');
            updateStatus('üí• LocalStorage del carrito limpiado');
        }
        
        function forceReinit() {
            if (window.forceInitCart) {
                const success = window.forceInitCart();
                updateStatus(success ? 'üîÑ Reinicializaci√≥n forzada exitosa' : '‚ùå Error en reinicializaci√≥n');
            } else {
                updateStatus('‚ùå Funci√≥n forceInitCart no disponible');
            }
        }
        
        function updateStatus(message) {
            const display = document.getElementById('statusDisplay');
            const timestamp = new Date().toLocaleTimeString();
            display.textContent = `[${timestamp}] ${message}`;
            console.log(`[Test Cart] ${message}`);
        }
        
        // Verificaci√≥n inicial
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateStatus('üöÄ P√°gina de test cargada\n' + 
                    `Carrito disponible: ${!!window.shoppingCart}\n` +
                    `Funci√≥n singleton: ${!!window.getShoppingCartInstance}`);
            }, 1000);
        });
        
        // Log cuando se navega
        window.addEventListener('beforeunload', function() {
            console.log('üîÑ Navegando desde test page...');
            if (window.shoppingCart && window.shoppingCart.items) {
                console.log(`üì¶ Items en carrito antes de navegar: ${window.shoppingCart.items.length}`);
            }
        });
    </script>
</body>
</html>
