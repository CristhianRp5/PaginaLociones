<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Rendimiento - Migraci√≥n URLs</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .results {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .metric {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #4ecdc4;
        }
        .metric-label {
            font-size: 1.2em;
            margin-top: 5px;
        }
        .improvement {
            color: #4ecdc4;
            font-weight: bold;
        }
        .warning {
            color: #ffa502;
            font-weight: bold;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .status.success { background: rgba(76, 175, 80, 0.3); }
        .status.warning { background: rgba(255, 193, 7, 0.3); }
        .status.error { background: rgba(244, 67, 54, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Test de Rendimiento - Migraci√≥n URLs</h1>
        
        <div class="test-section">
            <h2>üìä Pruebas de Rendimiento</h2>
            <button class="test-button" onclick="testRendimiento.testAdminPanel()">
                üîß Test Admin Panel
            </button>
            <button class="test-button" onclick="testRendimiento.testParaEllos()">
                üë® Test Para Ellos
            </button>
            <button class="test-button" onclick="testRendimiento.testParaEllas()">
                üë© Test Para Ellas
            </button>
            <button class="test-button" onclick="testRendimiento.testCompleto()">
                üéØ Test Completo
            </button>
        </div>

        <div class="test-section">
            <h2>üîÑ Migraci√≥n de Datos</h2>
            <button class="test-button" onclick="testRendimiento.verificarImagenes()">
                üîç Verificar Estado
            </button>
            <button class="test-button" onclick="testRendimiento.ejecutarMigracion()">
                ‚ö° Ejecutar Migraci√≥n
            </button>
            <button class="test-button" onclick="testRendimiento.crearProductosPrueba()">
                üß™ Productos de Prueba
            </button>
        </div>

        <div class="comparison">
            <div class="test-section">
                <h3>üîÑ Configuraci√≥n Anterior</h3>
                <div class="metric">
                    <div class="metric-value" id="oldAdminTime">-</div>
                    <div class="metric-label">Admin Panel (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="oldEllosTime">-</div>
                    <div class="metric-label">Para Ellos (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="oldEllasTime">-</div>
                    <div class="metric-label">Para Ellas (ms)</div>
                </div>
            </div>

            <div class="test-section">
                <h3>‚ö° Configuraci√≥n Optimizada</h3>
                <div class="metric">
                    <div class="metric-value" id="newAdminTime">-</div>
                    <div class="metric-label">Admin Panel (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="newEllosTime">-</div>
                    <div class="metric-label">Para Ellos (ms)</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="newEllasTime">-</div>
                    <div class="metric-label">Para Ellas (ms)</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìà Mejoras de Rendimiento</h2>
            <div id="improvements"></div>
        </div>

        <div class="test-section">
            <h2>üìã Resultados de Pruebas</h2>
            <div id="results" class="results"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Estado del Sistema</h2>
            <div id="status"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config-optimized.js"></script>
    <script src="../js/migracion-imagenes.js"></script>

    <script>
        class TestRendimiento {
            constructor() {
                this.resultados = [];
                this.init();
            }

            init() {
                this.log('üöÄ Iniciando test de rendimiento...');
                
                // Valores de referencia (medidos previamente)
                this.valoresReferencia = {
                    admin: 32446,
                    ellos: 2224,
                    ellas: 438
                };

                this.actualizarValoresReferencia();
                this.verificarEstadoSistema();
            }

            log(mensaje) {
                const timestamp = new Date().toLocaleTimeString();
                const formattedMessage = `[${timestamp}] ${mensaje}`;
                console.log(formattedMessage);
                
                const resultsDiv = document.getElementById('results');
                resultsDiv.textContent += formattedMessage + '\n';
                resultsDiv.scrollTop = resultsDiv.scrollHeight;
            }

            actualizarValoresReferencia() {
                document.getElementById('oldAdminTime').textContent = this.valoresReferencia.admin.toLocaleString();
                document.getElementById('oldEllosTime').textContent = this.valoresReferencia.ellos.toLocaleString();
                document.getElementById('oldEllasTime').textContent = this.valoresReferencia.ellas.toLocaleString();
            }

            async verificarEstadoSistema() {
                const statusDiv = document.getElementById('status');
                
                try {
                    if (!supabaseClient) {
                        const initialized = initSupabase();
                        if (!initialized) {
                            statusDiv.innerHTML = '<div class="status error">‚ùå Error: Supabase no disponible</div>';
                            return;
                        }
                    }

                    // Verificar conexi√≥n
                    const { data, error } = await supabaseClient
                        .from('productos')
                        .select('count')
                        .limit(1);

                    if (error) {
                        statusDiv.innerHTML = '<div class="status error">‚ùå Error de conexi√≥n: ' + error.message + '</div>';
                        return;
                    }

                    statusDiv.innerHTML = '<div class="status success">‚úÖ Sistema conectado y listo</div>';
                    
                } catch (error) {
                    statusDiv.innerHTML = '<div class="status error">‚ùå Error del sistema: ' + error.message + '</div>';
                }
            }

            async testAdminPanel() {
                this.log('üîß Iniciando test del Admin Panel...');
                
                const startTime = Date.now();
                
                try {
                    // Simular carga del admin panel
                    const productos = await ProductosServiceOptimized.obtenerProductosOptimizado({
                        limite: 15,
                        offset: 0
                    });

                    const endTime = Date.now();
                    const duration = endTime - startTime;

                    this.log(`‚úÖ Admin Panel cargado en ${duration}ms`);
                    document.getElementById('newAdminTime').textContent = duration.toLocaleString();
                    
                    this.calcularMejora('admin', duration);
                    
                    return { seccion: 'admin', tiempo: duration, productos: productos?.length || 0 };
                    
                } catch (error) {
                    this.log(`‚ùå Error en test Admin Panel: ${error.message}`);
                    return { seccion: 'admin', tiempo: -1, error: error.message };
                }
            }

            async testParaEllos() {
                this.log('üë® Iniciando test Para Ellos...');
                
                const startTime = Date.now();
                
                try {
                    const productos = await ProductosServiceOptimized.obtenerProductosOptimizado({
                        categoria: 'para-ellos',
                        limite: 20,
                        offset: 0
                    });

                    const endTime = Date.now();
                    const duration = endTime - startTime;

                    this.log(`‚úÖ Para Ellos cargado en ${duration}ms`);
                    document.getElementById('newEllosTime').textContent = duration.toLocaleString();
                    
                    this.calcularMejora('ellos', duration);
                    
                    return { seccion: 'ellos', tiempo: duration, productos: productos?.length || 0 };
                    
                } catch (error) {
                    this.log(`‚ùå Error en test Para Ellos: ${error.message}`);
                    return { seccion: 'ellos', tiempo: -1, error: error.message };
                }
            }

            async testParaEllas() {
                this.log('üë© Iniciando test Para Ellas...');
                
                const startTime = Date.now();
                
                try {
                    const productos = await ProductosServiceOptimized.obtenerProductosOptimizado({
                        categoria: 'para-ellas',
                        limite: 20,
                        offset: 0
                    });

                    const endTime = Date.now();
                    const duration = endTime - startTime;

                    this.log(`‚úÖ Para Ellas cargado en ${duration}ms`);
                    document.getElementById('newEllasTime').textContent = duration.toLocaleString();
                    
                    this.calcularMejora('ellas', duration);
                    
                    return { seccion: 'ellas', tiempo: duration, productos: productos?.length || 0 };
                    
                } catch (error) {
                    this.log(`‚ùå Error en test Para Ellas: ${error.message}`);
                    return { seccion: 'ellas', tiempo: -1, error: error.message };
                }
            }

            calcularMejora(seccion, tiempoNuevo) {
                const tiempoReferencia = this.valoresReferencia[seccion];
                const mejora = ((tiempoReferencia - tiempoNuevo) / tiempoReferencia) * 100;
                
                const improvementsDiv = document.getElementById('improvements');
                
                if (mejora > 0) {
                    improvementsDiv.innerHTML += `<div class="improvement">üìà ${seccion.toUpperCase()}: ${mejora.toFixed(1)}% m√°s r√°pido (${tiempoNuevo}ms vs ${tiempoReferencia}ms)</div>`;
                } else {
                    improvementsDiv.innerHTML += `<div class="warning">‚ö†Ô∏è ${seccion.toUpperCase()}: ${Math.abs(mejora).toFixed(1)}% m√°s lento (${tiempoNuevo}ms vs ${tiempoReferencia}ms)</div>`;
                }
            }

            async testCompleto() {
                this.log('üéØ Iniciando test completo...');
                
                const resultados = [];
                
                // Limpiar resultados previos
                document.getElementById('improvements').innerHTML = '';
                
                // Ejecutar todos los tests
                resultados.push(await this.testAdminPanel());
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                resultados.push(await this.testParaEllos());
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                resultados.push(await this.testParaEllas());
                
                // Calcular estad√≠sticas
                const tiempoTotal = resultados.reduce((sum, r) => sum + (r.tiempo > 0 ? r.tiempo : 0), 0);
                const productosTotal = resultados.reduce((sum, r) => sum + (r.productos || 0), 0);
                
                this.log(`\nüìä RESUMEN COMPLETO:`);
                this.log(`   ‚Ä¢ Tiempo total: ${tiempoTotal}ms`);
                this.log(`   ‚Ä¢ Productos cargados: ${productosTotal}`);
                this.log(`   ‚Ä¢ Promedio por secci√≥n: ${(tiempoTotal / 3).toFixed(0)}ms`);
                
                // Comparar con valores de referencia
                const tiempoReferenciaTotal = Object.values(this.valoresReferencia).reduce((sum, val) => sum + val, 0);
                const mejoraTotal = ((tiempoReferenciaTotal - tiempoTotal) / tiempoReferenciaTotal) * 100;
                
                this.log(`   ‚Ä¢ Mejora total: ${mejoraTotal.toFixed(1)}%`);
                
                return resultados;
            }

            async verificarImagenes() {
                this.log('üîç Verificando estado de im√°genes...');
                
                if (window.migracionImagenes) {
                    await window.migracionImagenes.verificarImagenes();
                } else {
                    this.log('‚ùå Script de migraci√≥n no disponible');
                }
            }

            async ejecutarMigracion() {
                this.log('‚ö° Ejecutando migraci√≥n de im√°genes...');
                
                if (window.migracionImagenes) {
                    await window.migracionImagenes.ejecutarMigracion();
                } else {
                    this.log('‚ùå Script de migraci√≥n no disponible');
                }
            }

            async crearProductosPrueba() {
                this.log('üß™ Creando productos de prueba...');
                
                if (window.migracionImagenes) {
                    await window.migracionImagenes.crearProductosPrueba();
                } else {
                    this.log('‚ùå Script de migraci√≥n no disponible');
                }
            }
        }

        // Inicializar test
        const testRendimiento = new TestRendimiento();
        
        // Hacer disponible globalmente
        window.testRendimiento = testRendimiento;
    </script>
</body>
</html>
