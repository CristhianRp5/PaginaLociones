<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Panel Admin - Paso a Paso</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; background: #007bff; color: white; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .step { margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>üß™ Test Panel Admin - Diagn√≥stico Paso a Paso</h1>
    
    <div id="step1" class="test-section">
        <h3>Paso 1: Verificar Supabase</h3>
        <button onclick="testStep1()">Probar Supabase</button>
        <div id="result1"></div>
    </div>
    
    <div id="step2" class="test-section">
        <h3>Paso 2: Verificar Scripts</h3>
        <button onclick="testStep2()">Probar Scripts</button>
        <div id="result2"></div>
    </div>
    
    <div id="step3" class="test-section">
        <h3>Paso 3: Probar ProductosService</h3>
        <button onclick="testStep3()">Probar ProductosService</button>
        <div id="result3"></div>
    </div>
    
    <div id="step4" class="test-section">
        <h3>Paso 4: Crear AdminPanel</h3>
        <button onclick="testStep4()">Crear AdminPanel</button>
        <div id="result4"></div>
    </div>
    
    <div id="step5" class="test-section">
        <h3>Paso 5: Simular Navegaci√≥n</h3>
        <button onclick="testStep5()">Simular Navegaci√≥n</button>
        <div id="result5"></div>
    </div>
    
    <div id="step6" class="test-section">
        <h3>Paso 6: Test Completo</h3>
        <button onclick="testCompleto()">Ejecutar Todo</button>
        <div id="resultCompleto"></div>
    </div>

    <!-- Mock DOM elements para testing -->
    <div style="display: none;">
        <div class="products-grid"></div>
        <div class="sidebar-menu">
            <a href="#dashboard">Dashboard</a>
            <a href="#productos">Productos</a>
        </div>
        <div class="content-section" id="dashboard"></div>
        <div class="content-section" id="productos"></div>
        <div class="dashboard-card" data-card="total-productos"><div class="number">0</div></div>
    </div>

    <!-- Scripts en orden -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="../js/admin-panel-new.js"></script>

    <script>
        let testResults = {};
        let testPanel = null;
        
        function updateResult(step, success, message, details = '') {
            const resultDiv = document.getElementById(`result${step}`);
            const className = success ? 'success' : 'error';
            
            resultDiv.className = `step ${className}`;
            resultDiv.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${message}</strong>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            
            testResults[step] = { success, message, details };
        }
        
        async function testStep1() {
            console.log('üß™ Testing Step 1: Supabase');
            
            try {
                const hasSupabase = typeof window.supabase !== 'undefined';
                const hasInitFunction = typeof initSupabase === 'function';
                
                let details = `Supabase global: ${hasSupabase ? '‚úÖ' : '‚ùå'}\n`;
                details += `initSupabase function: ${hasInitFunction ? '‚úÖ' : '‚ùå'}\n`;
                
                if (hasInitFunction) {
                    const initialized = initSupabase();
                    details += `Inicializaci√≥n: ${initialized ? '‚úÖ' : '‚ùå'}\n`;
                    
                    if (typeof supabaseClient !== 'undefined' && supabaseClient) {
                        details += `Cliente creado: ‚úÖ\n`;
                        details += `URL: ${supabaseClient.supabaseUrl}\n`;
                    } else {
                        details += `Cliente creado: ‚ùå\n`;
                    }
                }
                
                const allGood = hasSupabase && hasInitFunction;
                updateResult(1, allGood, allGood ? 'Supabase OK' : 'Problemas con Supabase', details);
                
            } catch (error) {
                updateResult(1, false, 'Error en Supabase', error.message);
            }
        }
        
        async function testStep2() {
            console.log('üß™ Testing Step 2: Scripts');
            
            try {
                let details = '';
                details += `ProductosService: ${typeof ProductosService !== 'undefined' ? '‚úÖ' : '‚ùå'}\n`;
                details += `AdminPanel: ${typeof AdminPanel !== 'undefined' ? '‚úÖ' : '‚ùå'}\n`;
                
                if (typeof ProductosService !== 'undefined') {
                    const methods = Object.getOwnPropertyNames(ProductosService);
                    details += `M√©todos ProductosService: ${methods.join(', ')}\n`;
                }
                
                const allGood = typeof ProductosService !== 'undefined' && typeof AdminPanel !== 'undefined';
                updateResult(2, allGood, allGood ? 'Scripts cargados OK' : 'Faltan scripts', details);
                
            } catch (error) {
                updateResult(2, false, 'Error verificando scripts', error.message);
            }
        }
        
        async function testStep3() {
            console.log('üß™ Testing Step 3: ProductosService');
            
            try {
                if (typeof ProductosService === 'undefined') {
                    updateResult(3, false, 'ProductosService no disponible', '');
                    return;
                }
                
                const productos = await ProductosService.obtenerProductos();
                const details = `Productos obtenidos: ${productos.length}\n${JSON.stringify(productos.slice(0, 2), null, 2)}`;
                
                updateResult(3, true, `ProductosService OK - ${productos.length} productos`, details);
                
            } catch (error) {
                updateResult(3, false, 'Error en ProductosService', error.message);
            }
        }
        
        async function testStep4() {
            console.log('üß™ Testing Step 4: AdminPanel');
            
            try {
                if (typeof AdminPanel === 'undefined') {
                    updateResult(4, false, 'AdminPanel class no disponible', '');
                    return;
                }
                
                // Crear instancia
                testPanel = new AdminPanel();
                
                // Esperar a que se inicialice
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                let details = '';
                details += `Panel creado: ‚úÖ\n`;
                details += `Productos cargados: ${testPanel.productos ? testPanel.productos.length : 0}\n`;
                details += `Secci√≥n actual: ${testPanel.currentSection || 'N/A'}\n`;
                details += `Navegaci√≥n configurada: ${testPanel.setupNavigation ? '‚úÖ' : '‚ùå'}\n`;
                
                updateResult(4, true, 'AdminPanel creado OK', details);
                
            } catch (error) {
                updateResult(4, false, 'Error creando AdminPanel', error.message);
            }
        }
        
        async function testStep5() {
            console.log('üß™ Testing Step 5: Navegaci√≥n');
            
            try {
                if (!testPanel) {
                    updateResult(5, false, 'Panel no creado primero', 'Ejecuta el paso 4 primero');
                    return;
                }
                
                // Test navegaci√≥n
                testPanel.showSection('productos');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const activeSection = document.querySelector('.content-section.active');
                const productsGrid = document.querySelector('.products-grid');
                
                let details = '';
                details += `Secci√≥n activa: ${activeSection ? activeSection.id : 'ninguna'}\n`;
                details += `Products grid: ${productsGrid ? '‚úÖ' : '‚ùå'}\n`;
                details += `loadProductsData existe: ${typeof testPanel.loadProductsData === 'function' ? '‚úÖ' : '‚ùå'}\n`;
                
                updateResult(5, true, 'Navegaci√≥n OK', details);
                
            } catch (error) {
                updateResult(5, false, 'Error en navegaci√≥n', error.message);
            }
        }
        
        async function testCompleto() {
            console.log('üß™ Running complete test...');
            
            await testStep1();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testStep2();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testStep3();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testStep4();
            await new Promise(resolve => setTimeout(resolve, 2500));
            
            await testStep5();
            
            // Resumen
            const results = Object.values(testResults);
            const successful = results.filter(r => r.success).length;
            const total = results.length;
            
            const resultDiv = document.getElementById('resultCompleto');
            const allGood = successful === total;
            
            resultDiv.className = `step ${allGood ? 'success' : 'warning'}`;
            resultDiv.innerHTML = `
                <strong>${allGood ? '‚úÖ' : '‚ö†Ô∏è'} Resultado: ${successful}/${total} pasos exitosos</strong>
                <pre>Resumen:
${results.map((r, i) => `Paso ${i + 1}: ${r.success ? '‚úÖ' : '‚ùå'} ${r.message}`).join('\n')}</pre>
            `;
        }
        
        // Auto-run despu√©s de cargar
        setTimeout(() => {
            console.log('üöÄ Auto-ejecutando tests...');
            testCompleto();
        }, 1000);
    </script>
</body>
</html>
