<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Versi√≥n Simplificada</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .container { display: flex; min-height: 80vh; gap: 20px; }
        .sidebar { width: 250px; background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .content { flex: 1; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .nav-link { display: block; padding: 10px 15px; margin: 5px 0; text-decoration: none; color: #333; border-radius: 4px; cursor: pointer; }
        .nav-link:hover, .nav-link.active { background: #007bff; color: white; }
        .section { display: none; }
        .section.active { display: block; }
        .btn { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; }
        .product-image img { width: 100%; height: 150px; object-fit: cover; border-radius: 4px; }
        .debug { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 12px; }
        .status { padding: 5px 10px; border-radius: 4px; margin: 5px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>Panel de Administraci√≥n - Versi√≥n Simplificada</h1>
    
    <div id="statusBar" class="debug"></div>
    
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h3>Navegaci√≥n</h3>
            <div class="nav-link active" onclick="showSection('dashboard')">
                üìä Dashboard
            </div>
            <div class="nav-link" onclick="showSection('productos')">
                üì¶ Productos
            </div>
            <div class="nav-link" onclick="showSection('agregar')">
                ‚ûï Agregar Producto
            </div>
            
            <hr style="margin: 20px 0;">
            
            <h4>Debug</h4>
            <button class="btn" onclick="debugStatus()">üîç Estado</button>
            <button class="btn" onclick="loadProducts()">üîÑ Cargar</button>
            <button class="btn" onclick="testConnection()">üì° Conectar</button>
        </div>
        
        <!-- Content -->
        <div class="content">
            <!-- Dashboard -->
            <div id="dashboard" class="section active">
                <h2>üìä Dashboard</h2>
                <div id="dashboardStats" class="debug">Cargando estad√≠sticas...</div>
            </div>
            
            <!-- Productos -->
            <div id="productos" class="section">
                <h2>üì¶ Gesti√≥n de Productos</h2>
                <button class="btn" onclick="refreshProducts()">üîÑ Actualizar Productos</button>
                <div id="productsStatus" class="debug">Estado: Esperando...</div>
                <div class="products-grid" id="productsGrid">
                    <!-- Los productos se cargar√°n aqu√≠ -->
                </div>
            </div>
            
            <!-- Agregar -->
            <div id="agregar" class="section">
                <h2>‚ûï Agregar Producto</h2>
                <div id="addProductForm">
                    <p>Formulario de productos en desarrollo...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js"></script>

    <script>
        // Variables globales
        let currentSection = 'dashboard';
        let productos = [];
        let isInitialized = false;
        
        // Funci√≥n para mostrar estado
        function updateStatus(message, type = 'info') {
            const statusBar = document.getElementById('statusBar');
            const now = new Date().toLocaleTimeString();
            statusBar.innerHTML = `[${now}] ${message}`;
            statusBar.className = `debug ${type}`;
            console.log(`[${now}] ${message}`);
        }
        
        // Navegaci√≥n
        function showSection(sectionName) {
            console.log(`üéØ Navegando a: ${sectionName}`);
            
            // Remover active de todos los links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Remover active de todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Activar link clickeado
            event.target.classList.add('active');
            
            // Activar secci√≥n
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionName;
                updateStatus(`Naveg√≥ a: ${sectionName}`, 'success');
                
                // Cargar datos espec√≠ficos
                loadSectionData(sectionName);
            } else {
                updateStatus(`Error: Secci√≥n '${sectionName}' no encontrada`, 'error');
            }
        }
        
        // Cargar datos de secci√≥n
        async function loadSectionData(sectionName) {
            switch (sectionName) {
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'productos':
                    await loadProductsSection();
                    break;
            }
        }
        
        // Dashboard
        async function loadDashboard() {
            const statsDiv = document.getElementById('dashboardStats');
            
            try {
                const stats = {
                    'Total Productos': productos.length,
                    'Supabase': typeof supabaseClient !== 'undefined' ? 'Conectado' : 'Desconectado',
                    'ProductosService': typeof ProductosService !== 'undefined' ? 'Disponible' : 'No disponible',
                    '√öltima actualizaci√≥n': new Date().toLocaleTimeString()
                };
                
                statsDiv.innerHTML = Object.entries(stats)
                    .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                    .join('<br>');
                    
            } catch (error) {
                statsDiv.innerHTML = `Error: ${error.message}`;
            }
        }
        
        // Productos
        async function loadProductsSection() {
            const statusDiv = document.getElementById('productsStatus');
            const gridDiv = document.getElementById('productsGrid');
            
            statusDiv.innerHTML = 'Cargando productos...';
            gridDiv.innerHTML = '';
            
            try {
                if (productos.length === 0) {
                    await refreshProducts();
                } else {
                    renderProducts();
                }
            } catch (error) {
                statusDiv.innerHTML = `Error: ${error.message}`;
            }
        }
        
        // Cargar productos
        async function loadProducts() {
            updateStatus('Iniciando carga de productos...', 'warning');
            
            try {
                if (typeof ProductosService === 'undefined') {
                    throw new Error('ProductosService no disponible');
                }
                
                productos = await ProductosService.obtenerProductos();
                updateStatus(`‚úÖ ${productos.length} productos cargados`, 'success');
                
                // Si estamos en la secci√≥n productos, actualizar
                if (currentSection === 'productos') {
                    renderProducts();
                }
                
                return productos;
                
            } catch (error) {
                updateStatus(`‚ùå Error cargando productos: ${error.message}`, 'error');
                productos = [];
                return [];
            }
        }
        
        // Renderizar productos
        function renderProducts() {
            const gridDiv = document.getElementById('productsGrid');
            const statusDiv = document.getElementById('productsStatus');
            
            if (productos.length === 0) {
                gridDiv.innerHTML = '<div class="debug warning">No hay productos disponibles</div>';
                statusDiv.innerHTML = 'Sin productos';
                return;
            }
            
            const productsHTML = productos.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        <img src="${product.imagen_url || product.imagen || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjVGNUYwIi8+CjxwYXRoIGQ9Ik04NSA2MEM4NSA1MS43NiA5MS43NiA0NSAxMDAgNDVDMTA4LjI0IDQ1IDExNSA1MS43NiAxMTUgNjBWOTBDMTE1IDk4LjI0IDEwOC4yNCAxMDUgMTAwIDEwNUM5MS43NiAxMDUgODUgOTguMjQgODUgOTBWNjBaIiBmaWxsPSIjQjg4NjBCIi8+CjxwYXRoIGQ9Ik05MCA3NUg5NVY4MEg5MFY3NVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMDUgNzVIMTEwVjgwSDEwNVY3NVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik05NSA4NUgxMDVWOTBIOTVWODVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4='}" 
                             alt="${product.nombre}"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjVGNUYwIi8+CjxwYXRoIGQ9Ik04NSA2MEM4NSA1MS43NiA5MS43NiA0NSAxMDAgNDVDMTA4LjI0IDQ1IDExNSA1MS43NiAxMTUgNjBWOTBDMTE1IDk4LjI0IDEwOC4yNCAxMDUgMTAwIDEwNUM5MS43NiAxMDUgODUgOTguMjQgODUgOTBWNjBaIiBmaWxsPSIjQjg4NjBCIi8+CjxwYXRoIGQ9Ik05MCA3NUg5NVY4MEg5MFY3NVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMDUgNzVIMTEwVjgwSDEwNVY3NVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik05NSA4NUgxMDVWOTBIOTVWODVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4=';">
                    </div>
                    <div class="product-info">
                        <h3>${product.nombre}</h3>
                        <p><strong>Marca:</strong> ${product.marca || 'N/A'}</p>
                        <p><strong>Precio:</strong> $${formatPrice(product.precio || 0)}</p>
                        <p><strong>Categor√≠a:</strong> ${product.categoria || 'N/A'}</p>
                        <p><strong>ID:</strong> ${product.id}</p>
                    </div>
                </div>
            `).join('');
            
            gridDiv.innerHTML = productsHTML;
            statusDiv.innerHTML = `${productos.length} productos mostrados`;
        }
        
        // Funciones auxiliares
        function formatPrice(price) {
            return new Intl.NumberFormat('es-CO').format(price || 0);
        }
        
        async function refreshProducts() {
            updateStatus('Refrescando productos...', 'warning');
            await loadProducts();
            if (currentSection === 'productos') {
                renderProducts();
            }
        }
        
        async function testConnection() {
            updateStatus('Probando conexi√≥n...', 'warning');
            
            try {
                if (typeof initSupabase === 'function') {
                    const result = initSupabase();
                    updateStatus(`Supabase init: ${result ? 'OK' : 'Fall√≥'}`, result ? 'success' : 'error');
                }
                
                if (typeof ProductosService !== 'undefined') {
                    const testProducts = await ProductosService.obtenerProductos();
                    updateStatus(`Conexi√≥n OK: ${testProducts.length} productos disponibles`, 'success');
                } else {
                    updateStatus('ProductosService no disponible', 'error');
                }
                
            } catch (error) {
                updateStatus(`Error de conexi√≥n: ${error.message}`, 'error');
            }
        }
        
        function debugStatus() {
            const debug = {
                'Secci√≥n actual': currentSection,
                'Productos cargados': productos.length,
                'Supabase': typeof window.supabase !== 'undefined',
                'supabaseClient': typeof supabaseClient !== 'undefined',
                'ProductosService': typeof ProductosService !== 'undefined',
                'initSupabase': typeof initSupabase === 'function',
                'AdminPanel disponible': typeof AdminPanel !== 'undefined'
            };
            
            console.table(debug);
            updateStatus(`Debug info logged to console`, 'info');
        }
        
        // Inicializaci√≥n
        async function init() {
            updateStatus('Inicializando panel...', 'warning');
            
            // Esperar a que los scripts se carguen
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Probar conexi√≥n
            await testConnection();
            
            // Cargar datos iniciales
            await loadProducts();
            
            // Cargar dashboard
            await loadDashboard();
            
            isInitialized = true;
            updateStatus('Panel inicializado correctamente', 'success');
        }
        
        // Auto-inicializar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(init, 500);
        });
    </script>
</body>
</html>
